<div class="space-y-6 flash-in">
    <!-- Result banner -->
    <div class="p-5 rounded-xl {{ 'bg-emerald-900/40 border border-emerald-800/60' if feedback.is_correct else 'bg-red-900/40 border border-red-800/60' }}">
        <div class="text-center text-xl font-bold mb-2
                    {{ 'text-emerald-400' if feedback.is_correct else 'text-red-400' }}">
            {{ 'Correct' if feedback.is_correct else 'Incorrect' }}
        </div>
        <p class="text-center text-gray-300 text-sm">{{ feedback.explanation }}</p>
    </div>

    <!-- Strategy breakdown -->
    <div class="bg-gray-900/60 rounded-xl p-4 space-y-3">
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">
            Your hand: {{ feedback.bucket_label }}
        </h3>
        <div class="space-y-1.5">
            {% for action, prob in feedback.strategy.items() | sort(attribute='1', reverse=true) %}
            <div class="flex items-center gap-3">
                <span class="text-sm text-gray-400 w-20">
                    {{ feedback.action_labels.get(action, action) }}
                </span>
                <div class="flex-1 bg-gray-800 rounded-full h-2.5 overflow-hidden">
                    <div class="h-full rounded-full
                                {% if action in feedback.correct_actions %}bg-emerald-500{% else %}bg-gray-600{% endif %}"
                         style="width: {{ (prob * 100) | int }}%"></div>
                </div>
                <span class="text-xs text-gray-500 w-10 text-right font-mono">{{ (prob * 100) | int }}%</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Range-vs-range breakdown -->
    {% if feedback.range_breakdown %}
    <div class="bg-gray-900/60 rounded-xl p-4">
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
            Full Range Strategy ({{ feedback.texture_label }})
        </h3>
        <div class="space-y-2 text-sm">
            {% for bucket, strat in feedback.range_breakdown.items() %}
            <div class="flex items-start gap-2">
                <span class="text-gray-400 w-24 shrink-0 font-mono text-xs
                            {% if bucket == feedback.bucket %}text-yellow-400 font-bold{% endif %}">
                    {{ bucket }}
                </span>
                <span class="text-gray-500 text-xs">
                    {% for action, prob in strat.items() | sort(attribute='1', reverse=true) %}
                        {{ feedback.action_labels.get(action, action) }} {{ (prob * 100) | int }}%{{ ', ' if not loop.last }}
                    {% endfor %}
                </span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Next hand -->
    <div class="text-center pt-2">
        <form id="next-form">
            <input type="hidden" name="streak" value="{{ streak }}">
            <button type="button"
                    hx-post="/api/postflop/next"
                    hx-include="#next-form"
                    hx-target="#scenario-zone"
                    hx-swap="innerHTML"
                    class="px-8 py-3 bg-gray-800 hover:bg-gray-700 rounded-lg
                           font-semibold transition-all text-sm">
                Next Hand &rarr;
            </button>
        </form>
    </div>
</div>

<!-- OOB streak update -->
<span id="streak-val" hx-swap-oob="innerHTML">{{ streak }}</span>
